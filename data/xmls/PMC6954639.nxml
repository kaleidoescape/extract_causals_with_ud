<!DOCTYPE article
PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD with MathML3 v1.2 20190208//EN" "JATS-archivearticle1-mathml3.dtd">
<article xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:mml="http://www.w3.org/1998/Math/MathML" article-type="brief-report"><?properties open_access?><front><journal-meta><journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id><journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id><journal-id journal-id-type="publisher-id">bioinformatics</journal-id><journal-title-group><journal-title>Bioinformatics</journal-title></journal-title-group><issn pub-type="ppub">1367-4803</issn><issn pub-type="epub">1367-4811</issn><publisher><publisher-name>Oxford University Press</publisher-name></publisher></journal-meta><article-meta><article-id pub-id-type="pmid">31350543</article-id><article-id pub-id-type="pmc">6954639</article-id><article-id pub-id-type="doi">10.1093/bioinformatics/btz566</article-id><article-id pub-id-type="publisher-id">btz566</article-id><article-categories><subj-group subj-group-type="heading"><subject>Applications Notes</subject><subj-group subj-group-type="category-toc-heading"><subject>Systems Biology</subject></subj-group></subj-group></article-categories><title-group><article-title>The nPYc-Toolbox, a Python module for the pre-processing, quality-control and analysis of metabolic profiling datasets</article-title></title-group><contrib-group><contrib contrib-type="author"><contrib-id contrib-id-type="orcid" authenticated="false">http://orcid.org/0000-0002-3749-7941</contrib-id><name><surname>Sands</surname><given-names>Caroline J</given-names></name><xref ref-type="corresp" rid="btz566-cor1"/><xref ref-type="aff" rid="btz566-aff1">1</xref><!--<email>caroline.sands@imperial.ac.uk</email>--></contrib><contrib contrib-type="author"><contrib-id contrib-id-type="orcid" authenticated="false">http://orcid.org/0000-0001-5856-3218</contrib-id><name><surname>Wolfer</surname><given-names>Arnaud M</given-names></name><xref ref-type="aff" rid="btz566-aff1">1</xref></contrib><contrib contrib-type="author"><name><surname>Correia</surname><given-names>Gon&#x000e7;alo D S</given-names></name><xref ref-type="aff" rid="btz566-aff1">1</xref></contrib><contrib contrib-type="author"><name><surname>Sadawi</surname><given-names>Noureddin</given-names></name><xref ref-type="aff" rid="btz566-aff2">2</xref></contrib><contrib contrib-type="author"><name><surname>Ahmed</surname><given-names>Arfan</given-names></name><xref ref-type="aff" rid="btz566-aff1">1</xref></contrib><contrib contrib-type="author"><name><surname>Jim&#x000e9;nez</surname><given-names>Beatriz</given-names></name><xref ref-type="aff" rid="btz566-aff1">1</xref><xref ref-type="aff" rid="btz566-aff2">2</xref></contrib><contrib contrib-type="author"><name><surname>Lewis</surname><given-names>Matthew R</given-names></name><xref ref-type="aff" rid="btz566-aff1">1</xref><xref ref-type="aff" rid="btz566-aff2">2</xref></contrib><contrib contrib-type="author"><name><surname>Glen</surname><given-names>Robert C</given-names></name><xref ref-type="aff" rid="btz566-aff2">2</xref></contrib><contrib contrib-type="author"><name><surname>Nicholson</surname><given-names>Jeremy K</given-names></name><xref ref-type="aff" rid="btz566-aff1">1</xref><xref ref-type="aff" rid="btz566-aff2">2</xref></contrib><contrib contrib-type="author"><contrib-id contrib-id-type="orcid" authenticated="false">http://orcid.org/0000-0003-4637-3171</contrib-id><name><surname>Pearce</surname><given-names>Jake T M</given-names></name><xref ref-type="aff" rid="btz566-aff1">1</xref><xref ref-type="aff" rid="btz566-aff2">2</xref></contrib></contrib-group><contrib-group><contrib contrib-type="editor"><name><surname>Valencia</surname><given-names>Alfonso</given-names></name><role>Associate Editor</role></contrib></contrib-group><aff id="btz566-aff1"><label>1</label>
<institution>National Phenome Centre and Imperial Clinical Phenotyping Centre, Department of Surgery &#x00026; Cancer</institution>, Imperial College London, London, <country country="GB">UK</country></aff><aff id="btz566-aff2"><label>2</label>
<institution>Division of Integrative Systems Medicine and Digestive Diseases</institution>, Department of Surgery &#x00026; Cancer, Imperial College London, South Kensington, London, <country country="GB">UK</country></aff><author-notes><corresp id="btz566-cor1">To whom correspondence should be addressed. E-mail: <email>caroline.sands@imperial.ac.uk</email></corresp></author-notes><pub-date pub-type="ppub"><day>15</day><month>12</month><year>2019</year></pub-date><pub-date pub-type="epub" iso-8601-date="2019-07-27"><day>27</day><month>7</month><year>2019</year></pub-date><pub-date pub-type="pmc-release"><day>27</day><month>7</month><year>2019</year></pub-date><!-- PMC Release delay is 0 months and 0 days and was based on the <pub-date pub-type="epub"/>. --><volume>35</volume><issue>24</issue><fpage>5359</fpage><lpage>5360</lpage><history><date date-type="received"><day>30</day><month>1</month><year>2019</year></date><date date-type="rev-recd"><day>18</day><month>6</month><year>2019</year></date><date date-type="accepted"><day>19</day><month>7</month><year>2019</year></date></history><permissions><copyright-statement>&#x000a9; The Author(s) 2019. Published by Oxford University Press.</copyright-statement><copyright-year>2019</copyright-year><license license-type="cc-by" xlink:href="http://creativecommons.org/licenses/by/4.0/"><license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p></license></permissions><self-uri xlink:href="btz566.pdf"/><abstract><title>Abstract</title><sec id="s1"><title>Summary</title><p>As large-scale metabolic phenotyping studies become increasingly common, the need for systemic methods for pre-processing and quality control (QC) of analytical data prior to statistical analysis has become increasingly important, both within a study, and to allow meaningful inter-study comparisons. The nPYc-Toolbox provides software for the import, pre-processing, QC and visualization of metabolic phenotyping datasets, either interactively, or in automated pipelines.</p></sec><sec id="s2"><title>Availability and implementation</title><p>The nPYc-Toolbox is implemented in Python, and is freely available from the Python package index <ext-link ext-link-type="uri" xlink:href="https://pypi.org/project/nPYc/">https://pypi.org/project/nPYc/</ext-link>, source is available at <ext-link ext-link-type="uri" xlink:href="https://github.com/phenomecentre/nPYc-Toolbox">https://github.com/phenomecentre/nPYc-Toolbox</ext-link>. Full documentation can be found at <ext-link ext-link-type="uri" xlink:href="http://npyc-toolbox.readthedocs.io/">http://npyc-toolbox.readthedocs.io/</ext-link> and exemplar datasets and tutorials at <ext-link ext-link-type="uri" xlink:href="https://github.com/phenomecentre/nPYc-toolbox-tutorials">https://github.com/phenomecentre/nPYc-toolbox-tutorials</ext-link>.</p></sec></abstract><funding-group><award-group award-type="grant"><funding-source><named-content content-type="funder-name">Medical Research Council and National Institute for Health Research</named-content></funding-source><award-id>MC_PC_12025</award-id></award-group><award-group award-type="grant"><funding-source><named-content content-type="funder-name">MRC-NIHR National Phenome Centre</named-content></funding-source></award-group><award-group award-type="grant"><funding-source><named-content content-type="funder-name">NIHR Imperial Biomedical Research Centre</named-content><named-content content-type="funder-identifier">10.13039/501100013342</named-content></funding-source></award-group><award-group award-type="grant"><funding-source><named-content content-type="funder-name">PhenoMeNal</named-content></funding-source></award-group><award-group award-type="grant"><funding-source><named-content content-type="funder-name">European Commission</named-content><named-content content-type="funder-identifier">10.13039/501100000780</named-content></funding-source><award-id>654241</award-id></award-group></funding-group><counts><page-count count="2"/></counts></article-meta></front><body><sec><title>1 Introduction</title><p>Metabolic phenotyping offers a powerful window into gene-environment interactions (<xref rid="btz566-B6" ref-type="bibr">Nicholson <italic>et al.</italic>, 2012</xref>). Inter-study comparison in the field is complicated by the diversity of analytical platforms used to generate data, and the lack of standard quality criteria. Standards are emerging around the most common platforms: Nuclear Magnetic Resonance spectroscopy (NMR), and hyphenated-Mass Spectrometry (MS), and procedures for the acquisition of profiles from human biofluid samples in particular are well established (<xref rid="btz566-B2" ref-type="bibr">Dona <italic>et al.</italic>, 2014</xref>; <xref rid="btz566-B5" ref-type="bibr">Lewis <italic>et al.</italic>, 2016</xref>). However, QC in profiling studies has typically been conducted on an ad-hoc basis in individual studies, although there is an increasing push towards the systematization and automation of pre-processing procedures (<xref rid="btz566-B4" ref-type="bibr">Giacomoni <italic>et al.</italic>, 2015</xref>; <xref rid="btz566-B8" ref-type="bibr">van Rijswijk <italic>et al.</italic>, 2017</xref>).</p><p>The toolbox presented here provides software for pre-processing, QC and visualization of metabolic profiling datasets, embodying the MRC-NIHR National Phenome Centre (NPC) practices and focusing on the interpretability of the output to both data generators and analysts (<xref ref-type="fig" rid="btz566-F1">Fig.&#x000a0;1</xref>).
</p><fig id="btz566-F1" orientation="portrait" position="float"><label>Fig. 1.</label><caption><p>Conceptual diagram outlining the workflow embodied by the toolbox, from import of raw or feature-extracted datasets, preprocessing and filtering, QC, visualization and export</p></caption><graphic xlink:href="btz566f1"/></fig></sec><sec><title>2 The nPYc-Toolbox</title><sec><title>2.1 Implementation</title><p>The toolbox is designed to allow reproducible processing of datasets with minimal reliance on human judgement during the process. It may be used interactively (e.g. in a Jupyter notebook, for which tutorials are provided), or as an API in automated workflows. It is coded in Python 3.6. To account for the differing processing workflows expected of the common analytical datasets outlined above, the toolbox subclasses its <italic>Dataset</italic> object; the <italic>NMRDataset</italic> encapsulates methods for handling spectral NMR data; <italic>MSDataset</italic> for discretely measured (peak-picked) hyphenated-MS profiling datasets; and <italic>TargetedDataset</italic> for targeted, quantified datasets, derived from MS, NMR or any other analytical platform.</p></sec><sec><title>2.2 Features</title><p>Dataset objects are initialized from raw (Bruker NMR) or feature-extracted data [outputs of software such as XCMS (<xref rid="btz566-B7" ref-type="bibr">Tautenhahn <italic>et al.</italic>, 2008</xref>), Progenesis QI<sup>TM</sup>, TargetLynx<sup>TM</sup>, &#x00026;c], and associated with study design parameters or metadata read directly from the raw data or from <sc>csv</sc> files. The <sc>csv</sc> template is structured so that each row corresponds to a sample, and columns contain a set of mandatory fields, and any other user required metadata. The role that each sample plays in the assay and its pre-processing is delineated using a standardized nomenclature.</p><p>Routines for pre-processing 1D NMR spectra by the automated calculation of QC metrics assessing line-width, water suppression and baseline stability are implemented (as described by <xref rid="btz566-B2" ref-type="bibr">Dona <italic>et al</italic>., 2014</xref>). Current best-practices in QC of profiling LC-MS (<xref rid="btz566-B1" ref-type="bibr">Broadhurst <italic>et al.</italic>, 2018</xref>; <xref rid="btz566-B3" ref-type="bibr">Dunn <italic>et al.</italic>, 2011</xref>; <xref rid="btz566-B5" ref-type="bibr">Lewis <italic>et al.</italic>, 2016</xref>; <xref rid="btz566-B9" ref-type="bibr">Want <italic>et al.</italic>, 2010</xref>) include repeated injections of pooled quality control samples, and a serial dilution of the reference sample to calculate <italic>per</italic> feature analytical precision and linearity of response. Correction of run-order effects follows an adapted version of the LOWESS approach proposed by <xref rid="btz566-B3" ref-type="bibr">Dunn <italic>et al.</italic> (2011)</xref>. The targeted pre-processing module contains a set of reports and data consistency checks, to assist analysts in assessing the presence of batch effects, standardizing the linearity range over multiple batches, and visualizing the distribution ranges of samples assayed and relationships within the limits of quantification.</p><p>Exploratory data analysis with PCA is used to assess the impact of the QC choices on the final dataset, and screen for associations between acquisition parameters and study factors.</p><p>Parameter sets can be specified as JSON dictionaries, allowing simple automation and generation of standardized workflows with basic auditing of all manipulations in a dataset. This toolbox can therefore be used to ensure reproducible pre-processing and quality control. Processed datasets can be exported as <sc>csv</sc> files in a number of different formats.</p></sec></sec><sec><title>3 Conclusion</title><p>The nPYc-Toolbox supports both profiling and targeted metabolic phenotyping datasets, and provides tools for pre-processing, quality control and visualization.</p></sec><sec><title>Funding</title><p>This work was supported by the Medical Research Council and National Institute for Health Research [grant number MC_PC_12025] through funding for the MRC-NIHR National Phenome Centre, infrastructure support was provided by the NIHR Imperial Biomedical Research Centre and PhenoMeNal, European Commission Horizon2020 programme, grant agreement number 654241.</p><p>
<italic>Conflict of Interest</italic>: none declared.</p></sec></body><back><ref-list id="ref1"><title>References</title><ref id="btz566-B1"><mixed-citation publication-type="journal">
<person-group person-group-type="author"><name name-style="western"><surname>Broadhurst</surname><given-names>D.</given-names></name></person-group>
<etal>et al</etal> (<year>2018</year>) 
<article-title>Guidelines and considerations for the use of system suitability and quality control samples in mass spectrometry assays applied in untargeted clinical metabolomic studies</article-title>. <source>Metabolomics</source>, <volume>14</volume>, <fpage>72.</fpage><pub-id pub-id-type="pmid">29805336</pub-id></mixed-citation></ref><ref id="btz566-B2"><mixed-citation publication-type="journal">
<person-group person-group-type="author"><name name-style="western"><surname>Dona</surname><given-names>A.C.</given-names></name></person-group>
<etal>et al</etal> (<year>2014</year>) 
<article-title>Precision high-throughput proton NMR spectroscopy of human urine, serum, and plasma for large-scale metabolic phenotyping</article-title>. <source>Anal. Chem</source>., <volume>86</volume>, <fpage>9887</fpage>&#x02013;<lpage>9894</lpage>.<pub-id pub-id-type="pmid">25180432</pub-id></mixed-citation></ref><ref id="btz566-B3"><mixed-citation publication-type="journal">
<person-group person-group-type="author"><name name-style="western"><surname>Dunn</surname><given-names>W.B.</given-names></name></person-group>
<etal>et al</etal> (<year>2011</year>) 
<article-title>Procedures for large-scale metabolic profiling of serum and plasma using gas chromatography and liquid chromatography coupled to mass spectrometry</article-title>. <source>Nat. Protoc</source>., <volume>6</volume>, <fpage>1060</fpage>&#x02013;<lpage>1083</lpage>.<pub-id pub-id-type="pmid">21720319</pub-id></mixed-citation></ref><ref id="btz566-B4"><mixed-citation publication-type="journal">
<person-group person-group-type="author"><name name-style="western"><surname>Giacomoni</surname><given-names>F.</given-names></name></person-group>
<etal>et al</etal> (<year>2015</year>) 
<article-title>Workflow4metabolomics: a collaborative research infrastructure for computational metabolomics</article-title>. <source>Bioinformatics</source>, <volume>31</volume>, <fpage>1493</fpage>&#x02013;<lpage>1495</lpage>.<pub-id pub-id-type="pmid">25527831</pub-id></mixed-citation></ref><ref id="btz566-B5"><mixed-citation publication-type="journal">
<person-group person-group-type="author"><name name-style="western"><surname>Lewis</surname><given-names>M.R.</given-names></name></person-group>
<etal>et al</etal> (<year>2016</year>) 
<article-title>Development and application of ultra-performance liquid chromatography&#x02013;TOF MS for precision large scale urinary metabolic phenotyping</article-title>. <source>Anal. Chem</source>., <volume>88</volume>, <fpage>9004</fpage>&#x02013;<lpage>9013</lpage>. PMID: 27479709.<pub-id pub-id-type="pmid">27479709</pub-id></mixed-citation></ref><ref id="btz566-B6"><mixed-citation publication-type="journal">
<person-group person-group-type="author"><name name-style="western"><surname>Nicholson</surname><given-names>J.</given-names></name></person-group>
<etal>et al</etal> (<year>2012</year>) 
<article-title>Metabolic phenotyping in clinical and surgical environments</article-title>. <source>Nature</source>, <volume>491</volume>, <fpage>384</fpage>&#x02013;<lpage>392</lpage>.<pub-id pub-id-type="pmid">23151581</pub-id></mixed-citation></ref><ref id="btz566-B7"><mixed-citation publication-type="journal">
<person-group person-group-type="author"><name name-style="western"><surname>Tautenhahn</surname><given-names>R.</given-names></name></person-group>
<etal>et al</etal> (<year>2008</year>) 
<article-title>Highly sensitive feature detection for high resolution LC/MS</article-title>. <source>BMC Bioinformatics</source>, <volume>9</volume>, <fpage>504.</fpage><pub-id pub-id-type="pmid">19040729</pub-id></mixed-citation></ref><ref id="btz566-B8"><mixed-citation publication-type="journal">
<person-group person-group-type="author"><name name-style="western"><surname>van Rijswijk</surname><given-names>M.</given-names></name></person-group>
<etal>et al</etal> (<year>2017</year>) 
<article-title>The future of metabolomics in elixir</article-title>. <source>F1000Research</source>, <volume>6</volume>, <fpage>1649.</fpage></mixed-citation></ref><ref id="btz566-B9"><mixed-citation publication-type="journal">
<person-group person-group-type="author"><name name-style="western"><surname>Want</surname><given-names>E.J.</given-names></name></person-group>
<etal>et al</etal> (<year>2010</year>) 
<article-title>Global metabolic profiling procedures for urine using UPLC&#x02013;MS</article-title>. <source>Nat. Protoc</source>., <volume>5</volume>, <fpage>1005</fpage>&#x02013;<lpage>1018</lpage>.<pub-id pub-id-type="pmid">20448546</pub-id></mixed-citation></ref></ref-list></back></article>